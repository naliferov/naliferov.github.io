import{a9 as r,aK as c,aa as f,F as S,aP as D,bM as g,bA as m,j as F,a6 as E,a8 as y,a7 as M,b as C,bL as T,u as v,w as K,ae as L}from"./runtime-core.esm-bundler-4_NpDWu2.js";const O=(d,e)=>{const n=d.__vccOpts||d;for(const[i,t]of e)n[i]=t;return n},P={class:"object-list"},V=["onClick"],z={__name:"objectList",props:{repoName:String,objects:Object,openObject:Function},setup(d){return(e,n)=>(c(),r("div",P,[n[0]||(n[0]=f("div",{class:"heading"},"System Objects",-1)),(c(!0),r(S,null,D(d.objects,(i,t)=>(c(),r("div",{key:t,class:"object",onClick:p=>d.openObject(d.repoName,t)},g(i.name),9,V))),128))]))}},A=O(z,[["__scopeId","data-v-a8d47449"]]),R={__name:"monacoEditor",props:{repoName:String,objectId:String,openedObjectId:String,code:String,position:Object},setup(d){const e=d,n=m(null),i=globalThis.x;return F(()=>{const t=monaco.editor.create(n.value,{value:e.code,language:"javascript",theme:"vs-dark",automaticLayout:!0,fontFamily:"Jetbrains Mono",fontSize:15});t.onDidChangeModelContent(()=>{i.updateObject({repoName:e.repoName,objectId:e.objectId,openedObjectId:e.openedObjectId,code:t.getValue(),position:t.getPosition()})}),e.position&&t.revealPositionInCenter(e.position),t.layout()}),(t,p)=>(c(),r("div",{ref_key:"codeContainer",ref:n,class:"monaco-editor"},null,512))}},q=O(R,[["__scopeId","data-v-d2368281"]]),H=["src"],J=["src"],U={__name:"frame",props:{id:[String,Number],openedObject:{type:Object,required:!0}},setup(d){new DragAndDrop;const e=d,n=m(null),i=m(null),t=m(null),p=m(""),a=m(""),k=E(()=>e.openedObject.object?.name??"");return F(async()=>{const _=e.openedObject,j=n.value.style;if(j.position="absolute",j.zIndex=10,j.top=0,_.frameParams)for(const o in _.frameParams)j[o]=_.frameParams[o];t.value.addEventListener("pointerdown",o=>{}),t.value.style.background="#e0e0e0",t.value.style.color="black",t.value.style.cursor="pointer";const h=i.value.attachShadow({mode:"open"}),I=document.createElement("style");h.append(I);const x=document.createElement("div");h.append(x);const u=_.object;u&&u.bin&&(u.type==="i"?p.value="data:image;base64,"+u.bin:u.type==="a"&&(a.value="data:audio/ogg;base64,"+u.bin))}),(_,j)=>(c(),r("div",{class:"frame",ref_key:"dom",ref:n},[f("div",{class:"top-bar",ref_key:"topBar",ref:t},g(k.value),513),f("div",{class:"app-container",ref_key:"appContainer",ref:i},null,512),p.value?(c(),r("img",{key:0,src:p.value,style:{display:"block"}},null,8,H)):y("",!0),a.value?(c(),r("audio",{key:1,autoplay:"",src:a.value,controls:""},null,8,J)):y("",!0)],512))}},G=O(U,[["__scopeId","data-v-7151fa47"]]),Q={key:1},W=["id"],X={__name:"openedObjects",setup(d){const e=globalThis.x,n=E(()=>e.openedObjects.value.map(t=>({...t,object:e.getById(t.objectId)}))),i=window.innerHeight;return(t,p)=>(c(),r("div",{class:"opened-objects",style:T({height:v(i)+"px",overflow:"auto"})},[(c(!0),r(S,null,D(n.value,a=>(c(),r("div",{key:a.id},[a.opener==="frame"?(c(),M(G,{key:0,openedObject:a},null,8,["openedObject"])):(c(),r("div",Q,[f("div",{id:a.id,class:"object-name"},g(a.object.name),9,W),C(q,{repoName:a.repoName,objectId:a.object.id,openedObjectId:a.id,code:a.object.code,position:a.position},null,8,["repoName","objectId","openedObjectId","code","position"])]))]))),128))],4))}},Y=O(X,[["__scopeId","data-v-faad39d0"]]),Z={class:"app-container"},ee={key:0,class:"left-sidebar"},te={class:"opened-objects-list"},oe=["onClick","onDblclick"],ne={key:0},$="sysInput",ce={__name:"main",setup(d){const e=globalThis.x,n=m(null),i=m(null),t=e.sys;e.user;const p=e.openedObjects,a=e.showSideBar,k=e.showFileInput,_=async(o,s)=>{const l=await e.getById(s),b={repoName:o,id:e.ulid(),objectId:s};l.bin&&(b.opener="frame"),p.value.push(b)},j=o=>{p.value=p.value.filter(s=>s.id!==o)},h=o=>{const s=document.getElementById(o);s&&s.scrollIntoView()},I=o=>{o.code==="Enter"&&o.preventDefault()},x=async o=>{if(o.code!=="Enter")return;const s=n.value?.textContent??"";e.kvRepo.set($,s);const[l,...b]=s.split(" "),N=e.sysCMDs,w=i.value?i.value.files[0]:null;if(b.bin=w?await e.readFileAsBase64(w):null,b.binMeta=w||null,!N[l])return;const B=N[l];B.f&&B.f(b)},u=o=>{const s=[];for(const l of o)s.push({...l,object:e.getById(l.objectId)});return s};return K(a,o=>{if(!o)return;const s=e.kvRepo.get($)||"Input cmd";n.value&&(n.value.textContent=s)},{immediate:!0,flush:"post"}),(o,s)=>(c(),r("div",Z,[v(a)?(c(),r("div",ee,[f("div",{class:"cmd-input",ref_key:"inputTextDom",ref:n,contenteditable:"plaintext-only",onKeydown:I,onKeyup:x},null,544),v(k)?(c(),r("input",{key:0,class:"file-input",ref_key:"inputFileDom",ref:i,type:"file"},null,512)):y("",!0),f("div",te,[s[0]||(s[0]=f("div",{class:"heading"},"Opened Objects",-1)),(c(!0),r(S,null,D(u(v(p)),l=>(c(),r("div",{class:"object",key:l.id,onClick:b=>h(l.id),onDblclick:b=>j(l.id)},[L(g(l.object.name)+" ",1),l.opener?(c(),r("span",ne," ("+g(l.opener)+")",1)):y("",!0)],40,oe))),128))]),C(A,{repoName:"sys",objects:v(t),openObject:_},null,8,["objects"])])):y("",!0),C(Y)]))}};export{ce as default};
