import{_ as T}from"./preload-helper-BlTxHScW.js";import{aJ as u,at as w,r as l,s as a,F as b,aL as m,aB as s,ak as B,b2 as E}from"./runtime-core.esm-bundler-CYxvy_wc.js";const F={class:"clip"},j=["onClick"],L={__name:"sequencer",setup(h){const i=globalThis.x,_=u(null),y=u(null);u([]);const n=u([]),c=["C2","C#2","D2","D#2","E2","F2","F#2","G2","G#2","A2","A#2","B2","C3","C#3","D3","D#3","E3","F3","F#3","G3","G#3","A3","A#3","B3"];for(let t=0;t<c.length;t++){n.value.push([]);for(let e=0;e<16;e++)n.value[t].push(0)}let p=null;const d=async()=>{if(!p){const t=await T(()=>import("./index-D6vuXKkY.js"),[]);p={Tone:t,synth:new t.Synth().toDestination()},await t.start()}return p},C=t=>{t.key!=="Enter"||i.getByName(y.value.value.trim())},g=async(t,e)=>{n.value[t][e]=!n.value[t][e],(await d()).synth.triggerAttackRelease(c[t],"16n"),await i.updateObject({repoName:"sys",objectId:"sequencerData",data:E(n.value)})};let v=null;const D=async()=>{const t=await d();t.Tone.Transport.bpm.value=120;let e=0;v=new t.Tone.Loop(r=>{for(let o=0;o<n.value.length;o++)n.value[o][e]&&t.synth.triggerAttackRelease(c[o],"16n",r);e=(e+1)%16},"16n"),v.start(0),t.Tone.Transport.start()},A=async()=>{(await d()).Tone.Transport.stop(),v.stop()};return w(async()=>{const t=await i.getObjectData("sequencerData");t&&(n.value=t)}),(t,e)=>(s(),l("div",{ref_key:"dom",ref:_},[a("input",{ref_key:"inputDom",ref:y,onKeyup:C},null,544),e[0]||(e[0]=a("br",null,null,-1)),e[1]||(e[1]=a("br",null,null,-1)),a("button",{class:"play-button",onClick:D},"Play"),a("button",{class:"play-button",onClick:A},"Stop"),e[2]||(e[2]=a("br",null,null,-1)),e[3]||(e[3]=a("br",null,null,-1)),a("div",F,[(s(!0),l(b,null,m(n.value,(r,o)=>(s(),l("div",{key:o,class:"row"},[(s(!0),l(b,null,m(r,(f,k)=>(s(),l("div",{key:k,class:B(["cell",{active:f}]),onClick:q=>g(o,k)},null,10,j))),128))]))),128))])],512))}};export{L as default};
