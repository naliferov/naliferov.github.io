import{N as i,aB as c,O as v,F as C,aH as N,bM as k,bw as j,av as $,J as M,c as P,M as g,L,Y as w,bL as F,bG as O,b2 as T,X as U}from"./runtime-dom.esm-bundler-CSgN8uhz.js";const I=(u,e)=>{const a=u.__vccOpts||u;for(const[p,n]of e)a[p]=n;return a},V={class:"object-list"},K=["onClick"],R={__name:"objectList",props:{repoName:String,objects:Object,openObject:Function},setup(u){return(e,a)=>(c(),i("div",V,[a[0]||(a[0]=v("div",{class:"heading"},"System Objects",-1)),(c(!0),i(C,null,N(u.objects,(p,n)=>(c(),i("div",{key:n,class:"object",onClick:b=>u.openObject(u.repoName,n)},k(p.name),9,K))),128))]))}},z=I(R,[["__scopeId","data-v-a8d47449"]]),A={__name:"monacoEditor",props:{repoName:String,objectId:String,openedObjectId:String,code:String,position:Object},setup(u){const e=u,a=j(null),p=globalThis.x;return $(()=>{const n=monaco.editor.create(a.value,{value:e.code,language:"javascript",theme:"vs-dark",automaticLayout:!0,fontFamily:"Jetbrains Mono",fontSize:15});n.onDidChangeModelContent(()=>{p.updateObject({repoName:e.repoName,objectId:e.objectId,openedObjectId:e.openedObjectId,code:n.getValue(),position:n.getPosition()})}),e.position&&n.revealPositionInCenter(e.position),n.layout()}),(n,b)=>(c(),i("div",{ref_key:"codeContainer",ref:a,class:"monaco-editor"},null,512))}},X=I(A,[["__scopeId","data-v-d2368281"]]),Y=["src"],H=["src"],J={__name:"frame",props:{id:[String,Number],openedObject:{type:Object,required:!0}},setup(u){const e=globalThis.x;class a{constructor(){this.targetDom=null,this.targetOpenedObject=null,this.xShift=0,this.yShift=0,this.updateObject=null}setUpdateObject(d){this.updateObject=d}activate(d,h,s){this.targetDom=h,this.targetOpenedObject=s;const t=this.targetDom.getBoundingClientRect();this.xShift=d.clientX-t.left,this.yShift=d.clientY-t.top,document.addEventListener("pointermove",this.onPointerMove),document.addEventListener("pointerup",this.onPointerUp)}onPointerMove=d=>{this.targetDom&&(this.targetDom.style.left=d.clientX-this.xShift+"px",this.targetDom.style.top=d.clientY-this.yShift+"px")};onPointerUp=()=>{document.removeEventListener("pointermove",this.onPointerMove),document.removeEventListener("pointerup",this.onPointerUp),this.targetDom&&(this.updateObject({repoName:this.targetOpenedObject.repoName,objectId:this.targetOpenedObject.object.id,openedObjectId:this.targetOpenedObject.id,frameParams:{left:this.targetDom.style.left,top:this.targetDom.style.top}}),this.targetDom=null,this.targetOpenedObject=null)}}const p=new a,n=u,b=j(null),r=j(null),f=j(null),_=j(""),y=j(""),x=M(()=>n.openedObject.object?.name??"");return $(async()=>{const m=n.openedObject;e.updateObject&&p.setUpdateObject(e.updateObject);const d=b.value.style;if(d.position="absolute",d.zIndex=10,d.top=0,m.frameParams)for(const l in m.frameParams)d[l]=m.frameParams[l];f.value.addEventListener("pointerdown",l=>{p.activate(l,b.value,m)}),f.value.style.background="#e0e0e0",f.value.style.color="black",f.value.style.cursor="pointer";const h=r.value.attachShadow({mode:"open"}),s=document.createElement("style");h.append(s);const t=document.createElement("div");h.append(t);const o=m.object;if(o){if(o.code){const l=await e.runById(m.objectId,{openedObject:m,updateObject:e.updateObject});P(l).mount(t);return}o.bin&&(o.type==="i"?_.value="data:image;base64,"+o.bin:o.type==="a"&&(y.value="data:audio/ogg;base64,"+o.bin))}}),(m,d)=>(c(),i("div",{class:"frame",ref_key:"dom",ref:b},[v("div",{class:"top-bar",ref_key:"topBar",ref:f},k(x.value),513),v("div",{class:"app-container",ref_key:"appContainer",ref:r},null,512),_.value?(c(),i("img",{key:0,src:_.value,style:{display:"block"}},null,8,Y)):g("",!0),y.value?(c(),i("audio",{key:1,autoplay:"",src:y.value,controls:""},null,8,H)):g("",!0)],512))}},q=I(J,[["__scopeId","data-v-03ae17d1"]]),G={key:1},Q=["id"],W={__name:"openedObjects",setup(u){const e=globalThis.x,a=M(()=>e.openedObjects.value.map(n=>({...n,object:e.getById(n.objectId)}))),p=window.innerHeight;return(n,b)=>(c(),i("div",{class:"opened-objects",style:F({height:O(p)+"px",overflow:"auto"})},[(c(!0),i(C,null,N(a.value,r=>(c(),i("div",{key:r.id},[r.opener==="frame"?(c(),L(q,{key:0,openedObject:r},null,8,["openedObject"])):(c(),i("div",G,[v("div",{id:r.id,class:"object-name"},k(r.object.name),9,Q),w(X,{repoName:r.repoName,objectId:r.object.id,openedObjectId:r.id,code:r.object.code,position:r.position},null,8,["repoName","objectId","openedObjectId","code","position"])]))]))),128))],4))}},Z=I(W,[["__scopeId","data-v-dc2d2acc"]]),ee={class:"app-container"},te={key:0,class:"left-sidebar"},oe={class:"opened-objects-list"},ne=["onClick","onDblclick"],se={key:0},E="sysInput",ae={__name:"main",setup(u){const e=globalThis.x,a=j(null),p=j(null),n=e.sys;e.user;const b=e.openedObjects,r=e.showSideBar,f=e.showFileInput,_=async(s,t)=>{const o=await e.getById(t),l={repoName:s,id:e.ulid(),objectId:t};o.bin&&(l.opener="frame"),b.value.push(l)},y=s=>{b.value=b.value.filter(t=>t.id!==s)},x=s=>{const t=document.getElementById(s);t&&t.scrollIntoView()},m=s=>{s.code==="Enter"&&s.preventDefault()},d=async s=>{if(s.code!=="Enter")return;const t=a.value?.textContent??"";e.kvRepo.set(E,t);const[o,...l]=t.split(" "),D=e.sysCMDs,S=p.value?p.value.files[0]:null;if(l.bin=S?await e.readFileAsBase64(S):null,l.binMeta=S||null,!D[o])return;const B=D[o];B.f&&B.f(l)},h=s=>{const t=[];for(const o of s)t.push({...o,object:e.getById(o.objectId)});return t};return T(r,s=>{if(!s)return;const t=e.kvRepo.get(E)||"Input cmd";a.value&&(a.value.textContent=t)},{immediate:!0,flush:"post"}),(s,t)=>(c(),i("div",ee,[O(r)?(c(),i("div",te,[v("div",{class:"cmd-input",ref_key:"inputTextDom",ref:a,contenteditable:"plaintext-only",onKeydown:m,onKeyup:d},null,544),O(f)?(c(),i("input",{key:0,class:"file-input",ref_key:"inputFileDom",ref:p,type:"file"},null,512)):g("",!0),v("div",oe,[t[0]||(t[0]=v("div",{class:"heading"},"Opened Objects",-1)),(c(!0),i(C,null,N(h(O(b)),o=>(c(),i("div",{class:"object",key:o.id,onClick:l=>x(o.id),onDblclick:l=>y(o.id)},[U(k(o.object.name)+" ",1),o.opener?(c(),i("span",se," ("+k(o.opener)+")",1)):g("",!0)],40,ne))),128))]),w(z,{repoName:"sys",objects:O(n),openObject:_},null,8,["objects"])])):g("",!0),w(Z)]))}};export{ae as default};
