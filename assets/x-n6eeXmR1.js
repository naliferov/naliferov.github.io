const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vue.runtime.esm-bundler-xPg14T-6.js","assets/runtime-dom.esm-bundler-CSgN8uhz.js","assets/main-UjnRwUNx.js","assets/main-C3KPlbG_.css"])))=>i.map(i=>d[i]);
import{_ as i}from"./index-DYpGKZeg.js";const c=await i(()=>import("./vue.runtime.esm-bundler-xPg14T-6.js"),__vite__mapDeps([0,1])),e={};globalThis.x=e;{const[{Redis:o},{ulid:s}]=await Promise.all([i(()=>import("https://esm.sh/@upstash/redis"),[]),i(()=>import("https://esm.sh/ulid?bundle"),[])]);e.redis=new o({url:"https://holy-redfish-7937.upstash.io",token:localStorage.getItem("token")||"Ah8BAAIgcDH8iJl1rQK-FZD7U3lrmcixchbsva9z2HQRDxtGlxLOrA"}),e.ulid=s}{const o=document.createElement("link");o.rel="stylesheet",o.href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap",document.head.append(o)}{const{promise:o,resolve:s}=Promise.withResolvers(),t=document.createElement("script");t.src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js",t.onload=()=>{require.config({paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/min/vs"}}),require(["vs/editor/editor.main"],s)},document.head.append(t),await o}{class o{get(t){return localStorage.getItem(t)}set(t,a){localStorage.setItem(t,a)}del(t){localStorage.removeItem(t)}on(t){this.set(t,"1")}off(t){this.del(t)}}e.kvRepo=new o}e.track=c.ref("sys");e.sys=c.ref({});e.user=c.ref({});e.openedObjects=c.ref([]);e.showSideBar=c.ref(!0);e.showFileInput=c.ref(!1);e.set=async(o,s)=>await e.redis.hset(e.track.value,{[o]:s});e.get=async o=>await e.redis.redis.hget(e.track.value,o);e.del=async o=>await e.redis.redis.hdel(e.track.value,o);{const o=Object.values(await e.redis.hgetall(e.track.value));o.sort((s,t)=>(s.name>t.name)-(s.name<t.name)),e.sys.value=Object.fromEntries(o.map(s=>[s.id,s]))}{const o=await e.kvRepo.get("openedObjects")??[];e.openedObjects.value=typeof o=="string"?JSON.parse(o):o,e.openedObjects.value=e.openedObjects.value.filter(s=>s.objectId&&e.sys.value[s.objectId]),c.watch(e.openedObjects,s=>{const t=s.map(a=>c.toRaw(a));e.kvRepo.set("openedObjects",JSON.stringify(t))},{deep:!0})}{const o="showFileInput";e.kvRepo.get(o)&&(e[o].value=!0),c.watch(e[o],s=>s?e.kvRepo.on(o):e.kvRepo.off(o))}e.getById=o=>e.sys.value[o];e.getByName=(o,s="sys")=>{const a=(s==="sys"?e.sys:e.user).value;for(const n in a){const r=a[n];if(r.name===o)return r}};e.runById=async(o,s={})=>{const t=e.getById(o);if(t&&t.code)return await e.runCode(t.code,s,t.name)};e.runByName=async(o,s={})=>{const t=e.getByName(o);if(t&&t.code)return await e.runCode(t.code,s,t.name)};e.getOpenedObject=o=>{for(const s of e.openedObjects.value)if(s.id===o)return s};e.updateObject=o=>{const t=(o.repoName==="sys"?e.sys:e.user).value[o.objectId];if(!t)return;const a=c.toRaw(t);o.code&&(a.code=o.code),o.data&&(a.data=o.data),(o.code||o.data)&&e.set(a.id,a);const n=e.getOpenedObject(o.openedObjectId);n&&(o.position&&(n.position=o.position),o.frameParams&&(n.frameParams=o.frameParams))};e.createCMDs=(o={})=>{const s={add:{f:async t=>{const[a]=t;if(e.getByName(a)){console.log(`object with name ${a} already exists`);return}const r={id:e.ulid(),name:a.trim()};t.bin&&(r.bin=t.bin),e.sys.value[r.id]=r,await e.set(r.id,r)},desc:"Function for adding new objects in list of functions. Example: add {new objectName}"},del:{f:async([t])=>{const a=e.getByName(t);if(a){delete e.sys.value[a.id],await e.del(a.id);return}console.log(`object with name ${t} not found`)},desc:"Function for deleting objects from the list by name. Example: del {objectName}"},delById:{f:async([t])=>await e.del(t),desc:"Function for delete object by id. Example: mv oldName newName"},mv:{f:async([t,a])=>{const n=e.getByName(t);n&&(n.name=a,await e.set(n.id,n))},desc:"Function for rename object. Example: mv oldName newName"},setProp:{f:async([t,a,n])=>{const r=e.getByName(t);!r||!a||!n||(r[a.trim()]=n.trim(),await e.set(r.id,r))},desc:"Find object by name, set prop and value. Example"},delProp:{f:async([t,a])=>{const n=e.getByName(t);n&&(delete n[a],await e.set(n.id,n))},desc:"Find object by name, del prop. Example"},open:{f([t,a]){const n=e.getByName(t);!n||!a||e.openedObjects.value.push({repoName:"sys",id:e.ulid(),objectId:n.id,opener:a})},desc:"Function for open objects as app. Example: run objectName arg1 arg2 ..."},log:{f:async([t])=>{const a=e.getByName(t);a&&console.log(c.toRaw(a))},desc:"Function for logging object by name. Example: run functionName arg1 arg2 ..."},fileInput:{f:async()=>{e.showFileInput.value=!e.showFileInput.value},desc:"Function for logging object by name. Example: run functionName arg1 arg2 ..."},exportDump:{f:async([])=>{const t=document.createElement("a");t.href=URL.createObjectURL(new Blob([JSON.stringify(e.sys.value)],{type:"application/json"})),t.download="dump.json",t.click(),URL.revokeObjectURL(t.href)},desc:"Export dump"}};return Object.assign(s,o),s};e.sysCMDs=e.createCMDs({repoName:"sys"});e.userCMDs=e.createCMDs({repoName:"user",async"import-dump"(){}});e.readFileAsBase64=async o=>{const{promise:s,resolve:t,reject:a}=Promise.withResolvers(),n=new FileReader;return n.readAsDataURL(o),n.onload=()=>{const r=n.result.split(",")[1];t(r)},n.onerror=a,s};{const{createApp:o}=c,{default:s}=await i(async()=>{const{default:t}=await import("./main-UjnRwUNx.js");return{default:t}},__vite__mapDeps([2,1,3]));e.app=o(s)}export{e as default};
